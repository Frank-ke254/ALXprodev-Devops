#!/bin/bash

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
API_URL="https://pokeapi.co/api/v2/pokemon"
OUTPUT_DIR="pokemon_data"
ERROR_LOG="errors.txt"

mkdir -p "$OUTPUT_DIR"
> "$ERROR_LOG"

echo "Starting data retrieval for multiple Pok√©mon..."
echo

for pokemon in "${POKEMONS[@]}"; do
    echo "Fetching data for $pokemon..."
    success=false

    for attempt in {1..3}; do
        response=$(curl -s -w "%{http_code}" -o "$OUTPUT_DIR/$pokemon.json.tmp" "$API_URL/$pokemon")
        status_code="${response:(-3)}"

        if [[ "$status_code" == "200" ]]; then
            mv "$OUTPUT_DIR/$pokemon.json.tmp" "$OUTPUT_DIR/$pokemon.json"
            echo "Saved data to $OUTPUT_DIR/$pokemon.json (Attempt $attempt)"
            success=true
            break
        else
            echo "Attempt $attempt failed for $pokemon (HTTP $status_code)"
            sleep 2
        fi
    done

    if [ "$success" = false ]; then
        echo "Failed to fetch data for $pokemon after 3 attempts" | tee -a "$ERROR_LOG"
        rm -f "$OUTPUT_DIR/$pokemon.json.tmp"
    fi

    sleep 1
done

echo
echo "All requests completed."
echo "Error log (if any):"
cat "$ERROR_LOG"
